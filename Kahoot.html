<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kahoot Quiz</title>
    <!-- Include axios from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

    <h1>Kahoot Quiz Information</h1>

    <!-- Input form for the user to enter the Kahoot ID -->
    <label for="kahootId">Input Kahoot ID:</label>
    <input type="text" id="kahootId" placeholder="Enter Kahoot ID">
    <br>
    
    <!-- Input form for the user to enter the proxy URL -->
    <label for="proxyUrl">Enter Proxy URL (Optional):</label>
    <input type="text" id="proxyUrl" placeholder="Enter proxy URL if needed">
    <br>
    
    <button onclick="submitKahootId()">Submit</button>

    <div id="quizInfo"></div>

    <script>
        // Function to handle user input and fetch quiz data
        function submitKahootId() {
            const kahootId = document.getElementById("kahootId").value;  // Get the input value
            const proxyUrl = document.getElementById("proxyUrl").value.trim();  // Get the proxy URL value
            
            if (kahootId) {
                if (proxyUrl) {
                    GetAnswersWithProxy(kahootId, proxyUrl);  // Fetch with proxy if provided
                } else {
                    GetAnswers(kahootId);  // Fetch normally if no proxy is provided
                }
            } else {
                alert("Please enter a valid Kahoot ID!");
            }
        }

        // Function to fetch quiz data using axios without a proxy
        function GetAnswers(KahootID) {
            const base_url = "https://create.kahoot.it/rest/kahoots/";
            const request_url = base_url + KahootID;  // Build the URL with Kahoot ID

            // Use axios to make the GET request
            axios.get(request_url)
                .then(response => {
                    const fent = response.data;  // Kahoot quiz data from the API
                    processQuizData(fent);  // Call function to process the quiz data
                })
                .catch(error => {
                    console.error("Error:", error);  // Handle any errors
                    alert("Failed to fetch quiz data. Please check the Kahoot ID.");
                });
        }

        // Function to fetch quiz data using a proxy to bypass CORS
        function GetAnswersWithProxy(KahootID, proxyUrl) {
            const base_url = "https://create.kahoot.it/rest/kahoots/";
            const request_url = base_url + KahootID;  // Build the URL with Kahoot ID

            // Prepend the proxy URL to the API request URL
            const proxiedUrl = `${proxyUrl}?url=${encodeURIComponent(request_url)}`;

            // Use axios to make the GET request through the proxy
            axios.get(proxiedUrl)
                .then(response => {
                    const fent = response.data;  // Kahoot quiz data from the API
                    processQuizData(fent);  // Call function to process the quiz data
                })
                .catch(error => {
                    console.error("Error:", error);  // Handle any errors
                    alert("Failed to fetch quiz data using the proxy. Please check the proxy URL.");
                });
        }

        // Function to process the quiz data
        function processQuizData(fent) {
            const quizInfoDiv = document.getElementById("quizInfo");
            quizInfoDiv.innerHTML = '';  // Clear previous results

            // Display questions and answers
            fent['questions'].forEach((question, i) => {
                if (question) {
                    // Display question type
                    quizInfoDiv.innerHTML += `<h3>Question ${i + 1} Type: ${question['type']}</h3>`;
                    
                    if (question['question']) {
                        // Display the question text
                        quizInfoDiv.innerHTML += `<p><strong>Question:</strong> ${question['question']}</p>`;
                        
                        if (question['choices']) {
                            // Loop through choices to check correct answer and color
                            question['choices'].forEach((choice, j) => {
                                if (choice['correct'] === true) {
                                    quizInfoDiv.innerHTML += `<p>Answer: ${choice['answer']} (Color: ${["Red", "Blue", "Yellow", "Green"][j]})</p>`;
                                }
                            });
                        }
                    }
                }
            });
        }
    </script>

</body>
</html>
